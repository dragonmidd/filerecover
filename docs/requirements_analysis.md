## 需求分析与验收标准 — FileRecover

本文档基于 `docs/requirements.md` 中的问卷草案（已由开发者填写），把用户目标（恢复误删的日常文件、操作便捷、恢复后能正常打开）细化为可验证的功能需求、非功能需求和验收标准，并给出对应的测试用例与里程碑建议。

### 一、简短“契约”（Contract）
- 输入：物理设备或镜像文件（支持 .dd/.img/.vhdx），以及用户选择的扫描/恢复参数。
- 输出：可恢复文件列表、文件预览、恢复导出包（目标路径）、操作审计日志和扫描/恢复报告。
- 错误模式：设备不可访问、权限不足、磁盘 I/O 错误、文件已被覆盖、深度恢复失败。
- 成功判定：导出的文件可在目标平台以默认程序打开且核心内容可用（例如 JPEG 可显示、DOCX 可打开且文本/主要结构存在）。

### 二、目标功能点（按优先级分组）
高优先级（MVP 必需）
- 设备与镜像选择（物理 \"\\.\\PhysicalDriveN\" 与 .dd/.img/.vhdx）
- 快速扫描（基于文件记录/元数据）与深度扫描（文件雕刻）两种模式
- NTFS / exFAT / FAT32 基础恢复能力
- 可恢复文件树视图与按类型/时间/大小过滤
- 文件预览（图片、文本、PDF、常见 Office 文档的基本预览）
- 批量恢复并导出到用户指定目录（默认禁止写回原盘）
- 扫描任务的暂停/继续与断点续查（保存扫描状态）
- 导出恢复结果为项目文件（用于断点恢复或批量复现）

中优先级
- 文件碎片重组（对简单碎片化场景能正确重建）
- 基本 EXIF 恢复与图片元数据保留
- 支持导入/分析用户提供的测试镜像清单

低优先级
- 更复杂文件系统（Ext、HFS+/APFS）支持
- 内核驱动与直接写回原盘（存在较高风险及签名成本）

### 三、验收标准（Acceptance Criteria）
按功能给出可验证标准：

1) 设备与镜像选择
- 验收：用户能在 GUI 中看到本机所有可访问物理驱动器与可选的镜像文件，并在选择后开始扫描流程。

2) 扫描（快速/深度）
- 验收：对同一镜像运行快速扫描与深度扫描，两者均能完成且深度扫描识别出比快速扫描更多的候选文件（差异 > 0）。
- 性能目标：在普通硬盘上，快速扫描 1TB ≤ 1 小时（可选目标），深度扫描 1TB ≤ 3 小时（依 I/O 与签名数量浮动）。

3) 恢复准确性（常见误删场景）
- 验收：针对包含 1000 个小文件（照片、文本、Office）的误删测试集，恢复成功率 ≥ 85%（其中成功定义为文件能被默认程序打开且内容主要可读）。

4) 文件完整性
- 验收：对 100 张 JPEG 文件样本，输出文件中至少 95% 能被图像查看器打开且不报错；对 Office 文档，80% 能被 Office 打开且可读主要文本（表格/图像可视为降级但可接受）。

5) 用户体验
- 验收：扫描过程中界面显示进度与估计剩余时间；暂停后能在重启程序后恢复扫描状态并继续（至少在同一台机器上）。

6) 安全与隐私
- 验收：默认不上传任何用户数据到外部服务器；审计日志保存在用户指定路径并可导出；如启用上传功能，需显式用户同意并使用 TLS+认证。

7) 稳定性与错误处理
- 验收：在磁盘 I/O 出错时，扫描任务能记录错误、跳过有问题的扇区并继续处理可访问区域，且不会导致程序崩溃（记录为错误级别日志）。

8) 权限策略
- 验收：在非管理员模式下应用以只读/镜像建议模式运行（阻止写回），在管理员模式下允许对设备执行镜像读取与恢复导出。

### 四、测试计划与具体测试用例（示例）
测试环境说明：使用一台 Windows 10 x64 测试机，准备若干镜像（.dd/.img）模拟不同场景。

测试用例 T1 — 回收站误删
- 准备：在测试分区中创建 500 张 JPEG、200 个 DOCX、300 个 TXT 文件，然后删除并不执行写入。
- 步骤：使用快速扫描并恢复全部可见文件。
- 期望：恢复成功率 ≥ 90%（打开性和内容完整性）。

测试用例 T2 — 快速格式化
- 准备：对分区执行快速格式化（FAT/exFAT/NTFS 各别）。
- 步骤：深度扫描并尝试恢复图片与文档文件。
- 期望：恢复常见文件类型的可打开文件率 ≥ 70%。

测试用例 T3 — 元数据损坏（MFT 部分损坏）
- 准备：在镜像中人工损坏部分 MFT 条目或 FAT 表。
- 步骤：深度扫描 + 文件雕刻
- 期望：能找到未被覆盖的文件签名并恢复出文件数据，成功率应记录并与基线对比。

测试用例 T4 — 断点续查
- 步骤：开始深度扫描，运行至 30% 暂停并退出程序；重新启动并载入扫描项目，继续扫描至完成。
- 期望：扫描能在此前位置恢复并最终完成，结果与未中断的完整扫描一致（允许极小差异，需记录）。

更多测试用例应覆盖碎片化文件、覆盖场景、不同文件系统和大文件（视频）等。

### 五、验收测试的衡量与报告
- 每次验收跑批次测试后，生成报告包含：测试环境、镜像来源、扫描时长、恢复总数、成功率（按文件类型分）、失败原因抽样、日志片段。
- 报告应归档到 `tests/reports/` 并附带用于复现的镜像与脚本（隐私要求下可用占位/描述代替真镜像）。

### 六、非功能性需求
- 可用性：GUI 在普通 1080p 分辨率上默认布局合理，主要操作不超过 3 步完成。
- 性能：将 I/O 操作尽量顺序化以减少随机读取开销，支持多线程解析与文件写出（避免对原盘并发写入）。
- 国际化：首版仅中文/英文；后续支持多语言。
- 可维护性：核心恢复逻辑模块化，具备良好的单元测试覆盖（关键模块 ≥ 70% 分支覆盖率目标）。

### 七、里程碑建议（示例）
- M0（2 周）：项目准备、问卷确认、架构方案完成
- M1（6 周）：核心引擎原型（磁盘读取、NTFS 简单解析、快速扫描）
- M2（12 周）：GUI 原型（设备选择、快速扫描、预览、批量恢复）、测试用例初版
- M3（20 周）：深度扫描、文件雕刻、断点续查、稳定性改进
- M4（24 周）：打包、签名、最终验收与发布候选

### 八、风险与缓解措施
- 驱动签名与内核驱动成本：缓解——首版避免内核驱动，使用镜像策略；若必须使用驱动则规划预算并限制为高级版本
- 覆盖导致的数据不可恢复性：缓解——在 UI 强制建议并默认创建镜像，弹窗提示风险
- 法务级链路要求复杂：缓解——把法务取证功能作为独立可选模块并设计链路完整性接口

### 九、交付物清单（对应验收）
- 源码仓库（分模块）、二进制安装包、引擎 DLL、CLI 工具、用户手册、测试报告、验收测试脚本与测试镜像（占位或说明）

---

下一步：
- 如果你确认该分析与验收标准，我将把此文档写入仓库（已写）并把 `系统架构与技术选型` 作为下一个任务开始输出架构方案草案。
- 或者你可以指定优先调整的条目（例如将扫描速度目标改为 1TB ≤ 1 小时或改变文件优先级）。
